

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Guide &mdash; BioImagePy 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Install" href="install.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> BioImagePy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-management">Data Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-running">Process Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_omero.html">Tutorial: Omero</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_wrap_a_tool.html">Tutorial: wrap a tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_write_a_metadata_plugin.html">Tutorial: write a metadata plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_write_a_runner_plugin.html">Tutorial: write a runner plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">bioimagepy</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BioImagePy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="guide">
<span id="id1"></span><h1>Guide<a class="headerlink" href="#guide" title="Permalink to this headline">¶</a></h1>
<p>BioImageIT-core is a python3 library. It implements the concepts described in the BioImageIT recommendations.
In the scheme below we can see the position of BioImageIT-core in the BioImageIT ecosystem. In fact, BioImageIT-core is the
API that connects low level image processing and data management to high level end users applications.</p>
<div class="figure align-center">
<img alt="_images/apps_layers.png" src="_images/apps_layers.png" />
</div>
<p>For data management, BioImageIT-core implements a set of functions to manage and annotate data at the Experiment
level. For image processing tools, BioImageIT-core implements a set of functions to query a tool database and
to run tools on data.</p>
<p>For Data management and process management, BioImageIT-core defines an API that can be implemented with plugins. For data
management by default, data is managed in a JSON file system. If we want to use the BioImageIT-core API to manage data on
a SQL database for example, we can implement a data management plugin that links the BioImageIT-core API with the SQL database.
For process run, BioImageIT-core by defaut runs tools using Docker containers in the local machine. If we want to run a processing
tool with a job scheduler for example, we can write a process runner plugin that links the BioImageIT-core API to the job scheduler.</p>
<p>The advantage of this BioImageIT-core architecture is to enable writing high level python code to manage and annotate data and deploy it
in different hardware or network architecture without the need to update the high level code, only the configuration file.</p>
<div class="section" id="data-management">
<h2>Data Management<a class="headerlink" href="#data-management" title="Permalink to this headline">¶</a></h2>
<p>In the BioImageIT recommendations, we propose to manage data using a three layer representation:</p>
<ul class="simple">
<li><p><strong>Experiment</strong>: an experiment contains one dataset of raw data named “data” and a list of processed datasets. Each processed dataset corresponds to a run of a tool.</p></li>
<li><p><strong>DataSet</strong>: a dataset contains a list of data that can be raw or processed</p></li>
<li><p><strong>Data</strong>: a data contains a single data and the associated metadata. For a <code class="docutils literal notranslate"><span class="pre">RawData</span></code> metadata are a set of <em>key:values</em> tags specific to the experiment, and for <code class="docutils literal notranslate"><span class="pre">ProcessedData</span></code>, metadata are the origin data and the process run information.</p></li>
</ul>
<p>In this section we show the main functions implemented in the BioImageIT-core library to handle <code class="docutils literal notranslate"><span class="pre">Data</span></code>, <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> and <code class="docutils literal notranslate"><span class="pre">Experiment</span></code>. Please
refer to the docstring documentation to get more advanced features.
To create an experiment, <em>BioImageIT-core</em> has a dedicated function with the following syntax:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myexperiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>
<span class="n">myexperiment</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;myexperiment&#39;</span><span class="p">,</span> <span class="s1">&#39;Sylvain Prigent&#39;</span><span class="p">,</span> <span class="s1">&#39;./&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates an empty repository with the basic metadata of the experiment. Then we can import a single data:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myexperiment</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="s1">&#39;data_uri&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mydata&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s1">&#39;Sylvain Prigent&#39;</span><span class="p">,</span> <span class="n">dataformat</span><span class="o">=</span><span class="s1">&#39;tif&#39;</span><span class="p">,</span> <span class="n">createddata</span><span class="o">=</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>or a multiple data from a directory:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myexperiment</span><span class="o">.</span><span class="n">import_dir</span><span class="p">(</span><span class="n">dir_uri</span><span class="o">=</span><span class="s1">&#39;./my/local/dir/&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;\.tif$&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s1">&#39;Sylvain Prigent&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;tif&#39;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="n">copy_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the next step is to tag the data. It can be done in batch with functions like:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myexperiment</span><span class="o">.</span><span class="n">tag_from_name</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;population1&#39;</span><span class="p">,</span> <span class="s1">&#39;population2&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myexperiment</span><span class="o">.</span><span class="n">tag_using_seperator</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">value_position</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>that will create tags and tag the data by extracting information from the data file names.
The first case will search the words <em>population1</em> and <em>population2</em> in the data file name and
associate it to the tag <em>population</em> if on the the word <em>population1</em> or <em>population2</em> is found.
The second case shows how to extract information from the data file name using separators. Here we
extract the sub-string in the file name that is located between two <em>_</em> and after the first <em>_</em>,
and associate the extracted value to the tag <em>ID</em>.
We can also manually tag one data by extracting it and manually adding a tag:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">myexperiment</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">:</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="s1">&#39;name=population1_001.tif&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="s2">&quot;Population1&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;001&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>BioImageIT-core</em> library also allows to access directly a <code class="docutils literal notranslate"><span class="pre">DataSet</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_dataset</span> <span class="o">=</span> <span class="n">myexperiment</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and interact with the data in the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">raw_dataset</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">raw_dataset</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="process-running">
<h2>Process Running<a class="headerlink" href="#process-running" title="Permalink to this headline">¶</a></h2>
<p>The BioImageIT recommendation descibe a packaging method to package data processing tools using an XML file and a docker image.
The <em>BioImageIT-core</em> library, implement functionalities to manipulate and run packaged tools using three level: Process, Runner and Pipeline.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Process</span></code> is a python class in <em>BioImageIT-core</em> that allows to identify a processing tool. It load the tool XML file and allows to print and access the process information.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myprocess</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">url</span><span class="o">/</span><span class="n">of</span><span class="o">/</span><span class="n">the</span><span class="o">/</span><span class="n">process</span><span class="o">/</span><span class="n">wrapper</span><span class="o">.</span><span class="n">xml</span><span class="p">)</span>
<span class="n">myprocess</span><span class="o">.</span><span class="n">man</span><span class="p">()</span>
</pre></div>
</div>
<p>In practice, we do not need to instantiate directly a <code class="docutils literal notranslate"><span class="pre">Process</span></code> since <em>BioImageIT-core</em> provides a <code class="docutils literal notranslate"><span class="pre">ProcessAccess</span></code>
class that manage a process database. We can then access a <code class="docutils literal notranslate"><span class="pre">Process</span></code> simply using the tool name and version:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myprocess</span> <span class="o">=</span> <span class="n">ProcessAccess</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sampletool_v0.0.1&#39;</span><span class="p">)</span>
<span class="n">myprocess</span><span class="o">.</span><span class="n">man</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Runner</span></code> class allows to run a process on data. This is the core class of the processing
functionality of <em>BioImageIT-core</em>. Running a process can be done as follows:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">myrunner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span><span class="n">ProcessAccess</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ndsafir_v1.0.0&#39;</span><span class="p">)</span>
<span class="n">myrunner</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;myimage.tif&#39;</span><span class="p">,</span>
              <span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span>
              <span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span>
              <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;denoised.tif&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally the <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> class is a convenient class that allows to run a sequence of processes in data stored in an <code class="docutils literal notranslate"><span class="pre">Experiment</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">mypipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">Experiment</span><span class="p">(</span><span class="s1">&#39;my/experiment/uri&#39;</span><span class="p">))</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">mypipeline</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="s1">&#39;spartion2d_v1.0.0&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;weighting&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;regularization&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">set_dataset_name</span><span class="p">(</span><span class="s1">&#39;deconv2d&#39;</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">mypipeline</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="s1">&#39;particleanalyzer_v1.0.0&#39;</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">set_parameters</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">,</span> <span class="s1">&#39;Default dark&#39;</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;deconv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">set_dataset_name</span><span class="p">(</span><span class="s1">&#39;particles&#39;</span><span class="p">)</span>

<span class="n">mypipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>In this short introduction guide we show the basic informations we need to use <em>BioImageIT-core</em>. For a more advanced use, we recommend
reading the following tutorials.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install.html" class="btn btn-neutral float-right" title="Install" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Sylvain Prigent

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>