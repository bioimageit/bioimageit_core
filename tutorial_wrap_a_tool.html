<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial: wrap a tool &mdash; bioimageit_core developers documentation 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial: write a data plugin" href="tutorial_write_a_data_plugin.html" />
    <link rel="prev" title="Install" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> bioimageit_core developers documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide.html">Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: wrap a tool</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#shed-file">Shed file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrapper">Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packaging-and-dependencies">Packaging and dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_write_a_data_plugin.html">Tutorial: write a data plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_write_a_runner_plugin.html">Tutorial: write a runner plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">bioimageit_core</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bioimageit_core developers documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Tutorial: wrap a tool</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial_wrap_a_tool.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial-wrap-a-tool">
<h1>Tutorial: wrap a tool<a class="headerlink" href="#tutorial-wrap-a-tool" title="Permalink to this heading"></a></h1>
<p>In this tutorial, we details the standardized architecture for a tool package. This architecture facilitate
tools access and sharing.</p>
<p>A package can contain one or several wrappers. The package architecture is as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.shed.yml</span></code>: a file describing the tools (authors, toolboxes names…)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test-data</span></code>: a directory containing data for demo and functional testing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wrapper.xml</span></code>: One or several wrapper file. One wrapper per tool</p></li>
</ul>
<p>This organisation is the same as the one used in the Galaxy Project for BioImageIT to be fully compatible with Galaxy Project</p>
<section id="shed-file">
<h2>Shed file<a class="headerlink" href="#shed-file" title="Permalink to this heading"></a></h2>
<p>The shed file descibe the tool origin and how BioImageIT will classify it in the toolboxes tree. Bellow an example file
gives the <code class="docutils literal notranslate"><span class="pre">.shed.yml</span></code> file content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">categories</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Denoising</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filtering</span><span class="w"></span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2D image smooth with mean filtering</span><span class="w"></span>
<span class="nt">homepage_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://gitlab.inria.fr/bioimage-it/sampletool/</span><span class="w"></span>
<span class="nt">long_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2D image smooth with mean filtering</span><span class="w"></span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SampleTool</span><span class="w"></span>
<span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sylvainprigent</span><span class="w"></span>
</pre></div>
</div>
<p>The <cite>categories</cite> entry is a list of the toolboxes where the tool(s) will appear.
The <cite>description</cite> and <cite>long_description</cite> are short and long description to identify what is the tool(s) purpose. These descriptions are
displayed to the user when browsing the toolboxes.
The <cite>homepage_url</cite> is a web URL of the original tool. Idealy this should be a GitHub or GitLab public page.
Finally <cite>name</cite> and <cite>owner</cite> are the names of the tool and the author(s) to identify them.</p>
</section>
<section id="wrapper">
<h2>Wrapper<a class="headerlink" href="#wrapper" title="Permalink to this heading"></a></h2>
<p>The tool wrapper is an <cite>XML</cite> file describing how to run the tool. An example is shown bellow for a 2D image Wiener deconvolution. It is a classical Galaxy Project wrapper.
The command is <code class="docutils literal notranslate"><span class="pre">simgwiener2d</span></code> and take 5 arguments, the input image <code class="docutils literal notranslate"><span class="pre">-i</span></code>, the output image <code class="docutils literal notranslate"><span class="pre">-o</span></code>, and 3 parameters <code class="docutils literal notranslate"><span class="pre">-sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">-lambda</span></code>
and <code class="docutils literal notranslate"><span class="pre">-padding</span></code>.
The first section is the <cite>&lt;requirements&gt;</cite>. It contains the description of the method to install the tool and its dependencies.
The section <cite>&lt;command&gt;</cite> gives the command line that is executed when the tool is ran. Note that all the values are replaced
with variables like <code class="docutils literal notranslate"><span class="pre">${sigma}</span></code> for the input <code class="docutils literal notranslate"><span class="pre">-sigma</span></code>. These variables will be replaced with the user inputs at run time.
In order to describe the tool inputs and outputs, the wrapper presents two specefic section: <cite>&lt;inputs&gt;</cite> and <cite>&lt;outputs&gt;</cite>.
Each input of the tool must be descibed in a <cite>&lt;param&gt;</cite> subsection and each output in a <cite>&lt;data&gt;</cite> subsection.</p>
<p>The <cite>&lt;test&gt;</cite> section is important to automatically test that the wrapper and the tools are working correctly. This section
can contains several tests and each test is the list of the input and output parameters and data values.</p>
<p>The <cite>&lt;help&gt;</cite> section should contains the link to a html or web documentation. The documentation can be stored locally in the
wrapper directory in a <em>doc</em> folder. This section can be completed with the <cite>&lt;citations&gt;</cite> one with references.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;tool</span> <span class="na">id=</span><span class="s">&quot;wienerdeconv2d&quot;</span> <span class="na">name=</span><span class="s">&quot;Wiener 2D&quot;</span> <span class="na">version=</span><span class="s">&quot;0.1.2&quot;</span> <span class="na">python_template_version=</span><span class="s">&quot;3.5&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;requirements&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">type=</span><span class="s">&quot;conda&quot;</span> <span class="na">env=</span><span class="s">&quot;simglib&quot;</span><span class="nt">&gt;</span>-c sylvainprigent simglib=0.1.2 python=3.9<span class="nt">&lt;/package&gt;</span>
    <span class="nt">&lt;/requirements&gt;</span>
    <span class="nt">&lt;command</span> <span class="na">detect_errors=</span><span class="s">&quot;exit_code&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        simgwiener2d -i ${i} -o ${o} -sigma ${sigma} -lambda ${lambda} -padding ${padding}</span>
<span class="cp">    ]]&gt;</span><span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;inputs&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">type=</span><span class="s">&quot;data&quot;</span> <span class="na">name=</span><span class="s">&quot;i&quot;</span> <span class="na">format=</span><span class="s">&quot;imagetiff&quot;</span> <span class="na">label=</span><span class="s">&quot;Input Image&quot;</span> <span class="na">help=</span><span class="s">&quot;2D image&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">argument=</span><span class="s">&quot;-sigma&quot;</span> <span class="na">type=</span><span class="s">&quot;float&quot;</span> <span class="na">value=</span><span class="s">&quot;1.5&quot;</span> <span class="na">label=</span><span class="s">&quot;Sigma&quot;</span> <span class="na">help=</span><span class="s">&quot;Gaussian PSF width&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">argument=</span><span class="s">&quot;-lambda&quot;</span> <span class="na">type=</span><span class="s">&quot;float&quot;</span> <span class="na">value=</span><span class="s">&quot;0.01&quot;</span> <span class="na">label=</span><span class="s">&quot;Lambda&quot;</span> <span class="na">help=</span><span class="s">&quot;Regularization parameter&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">argument=</span><span class="s">&quot;-padding&quot;</span> <span class="na">type=</span><span class="s">&quot;select&quot;</span> <span class="na">label=</span><span class="s">&quot;Padding&quot;</span> <span class="na">help=</span><span class="s">&quot;Add a padding to process pixels in borders&quot;</span> <span class="na">optional=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>False<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/inputs&gt;</span>
    <span class="nt">&lt;outputs&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">name=</span><span class="s">&quot;o&quot;</span> <span class="na">format=</span><span class="s">&quot;imagetiff&quot;</span> <span class="na">label=</span><span class="s">&quot;Denoised image&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/outputs&gt;</span>
    <span class="nt">&lt;tests&gt;</span>
        <span class="nt">&lt;test&gt;</span>
            <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;i&quot;</span> <span class="na">value=</span><span class="s">&quot;image.tif&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;sigma&quot;</span> <span class="na">value=</span><span class="s">&quot;1.5&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;lambda&quot;</span> <span class="na">value=</span><span class="s">&quot;0.001&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;padding&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;output</span> <span class="na">name=</span><span class="s">&quot;o&quot;</span> <span class="na">file=</span><span class="s">&quot;image_o.tif&quot;</span> <span class="na">compare=</span><span class="s">&quot;sim_size&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/test&gt;</span>
    <span class="nt">&lt;/tests&gt;</span>
    <span class="nt">&lt;help&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">        https://github.com/sylvainprigent/simglib</span>
<span class="cp">    ]]&gt;</span><span class="nt">&lt;/help&gt;</span>
    <span class="nt">&lt;citations&gt;</span>
    <span class="nt">&lt;/citations&gt;</span>
<span class="nt">&lt;/tool&gt;</span>
</pre></div>
</div>
</section>
<section id="packaging-and-dependencies">
<h2>Packaging and dependencies<a class="headerlink" href="#packaging-and-dependencies" title="Permalink to this heading"></a></h2>
<p>BioImageIT is able to run tool that are packaged either using <strong>Conda</strong> or <strong>Docker</strong>.</p>
<p>When using conda, the authors need to create a conda package and store it in anaconda.org. Then, the <cite>&lt;requirements&gt;</cite> section looks like the folowing:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;requirements&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">type=</span><span class="s">&quot;conda&quot;</span> <span class="na">env=</span><span class="s">&quot;simglib&quot;</span><span class="nt">&gt;</span>-c sylvainprigent simglib=0.1.2 python=3.9<span class="nt">&lt;/package&gt;</span>
<span class="nt">&lt;/requirements&gt;</span>
</pre></div>
</div>
<p>The package needs 2 arguments: type and env. For a <strong>Conda</strong> package the type is <em>conda</em> and the environement is the name
of the environement that will be created to install the tool. In the example above we named it <cite>simglib</cite> since it is the
name of the library that we install for the tool. Finally, the main body of <cite>&lt;package&gt;</cite> is the <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span></code> arguments.
In the example we wrote <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">sylvainprigent</span> <span class="pre">simglib=0.1.2</span> <span class="pre">python=3.9</span></code> to create an environement with python 3.9 and install
the version 0.1.2 of simglib from the <em>sylvainprigent</em> conda channel.</p>
<p>When using Docker, the author needs to build a docker image and store it in Docker hub or a Gitlab register. Then,
the requirement <cite>&lt;requirements&gt;</cite> section is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;requirements&gt;</span>
    <span class="nt">&lt;container</span> <span class="na">type=</span><span class="s">&quot;docker&quot;</span><span class="nt">&gt;</span>registry.gitlab.inria.fr/bioimage-it/sampletool:766efe8b8397fef0115e20f8e7cd2853a0e0e0d5<span class="nt">&lt;/container&gt;</span>
<span class="nt">&lt;/requirements&gt;</span>
</pre></div>
</div>
<p>where the container type is docker and the container body is the adress of the docker image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is no special section in the wrapper to specify a repository of the source code, but for transparency, it is
recommended to add is in the tool documentation.</p>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<p>In this tutorial, we show with an example how to create a tool package compatible with <em>BioImageIT</em> and Galaxy Project. This has
the advantages of using the original source code without changing it, but just packaging it with <em>Docker</em> or <em>Conda</em> and discribing it with a <em>wrapper</em> XML file.
To make a tool available, please send a push request <a class="reference external" href="https://github.com/bioimageit/bioimageit-tools">here</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Install" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial_write_a_data_plugin.html" class="btn btn-neutral float-right" title="Tutorial: write a data plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Sylvain Prigent.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>